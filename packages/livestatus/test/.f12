#!/bin/bash
# Copyright (C) 2019 tribe29 GmbH - License: Check_MK Enterprise License
# This file is part of Checkmk (https://checkmk.com). It is subject to the terms and
# conditions defined in the file COPYING, which is part of this source code package.

set -e

# TODO(sk): replace with cd .. && run_ci --test
cd ..
test -f build/Makefile || cmake -S . -B build
cmake --build build -t test

if test -z ${VALGRIND+x} && command -v valgrind >/dev/null; then
    VALGRIND="valgrind --quiet --num-callers=30 --error-exitcode=42"
fi
GTEST_OUTPUT=xml ${VALGRIND} build/test/test
