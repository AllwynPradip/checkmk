#!/usr/bin/env python3
# Copyright (C) 2019 tribe29 GmbH - License: GNU General Public License v2
# This file is part of Checkmk (https://checkmk.com). It is subject to the terms and
# conditions defined in the file COPYING, which is part of this source code package.

from cmk.base.plugins.agent_based.threepar_hosts import ThreeParHostsSection


def inventory_3par_hosts(section: ThreeParHostsSection):
    for host in section:
        yield (host, None)


def check_3par_hosts(
    item: str,
    _no_params,
    section: ThreeParHostsSection,
):

    if (host := section.get(item)) is None:
        return

    yield 0, f"ID: {host.id}"

    if host.os:
        yield 0, f"OS: {host.os}"

    if host.fc_paths_number:
        yield 0, f"FC Paths: {host.fc_paths_number}"
    elif host.iscsi_paths_number:
        yield 0, f"iSCSI Paths: {host.iscsi_paths_number}"


check_info["3par_hosts"] = {
    # Section already migrated!
    "inventory_function": inventory_3par_hosts,
    "check_function": check_3par_hosts,
    "service_description": "Host %s",
}
